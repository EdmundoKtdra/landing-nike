---
// ContactForm.astro
---

<section
  id="ContactForm"
  class="relative min-h-screen bg-black flex items-center justify-center px-4 py-20 overflow-hidden"
>
  <div class="absolute inset-0 pointer-events-none">
    <div
      class="absolute -top-1/2 -left-1/4 w-[150%] h-32 bg-lime-500/20 -rotate-12 blur-3xl"
    >
    </div>
    <div
      class="absolute bottom-0 right-0 w-96 h-96 bg-lime-400/10 rounded-full blur-[120px]"
    >
    </div>
  </div>

  <div class="relative z-10 w-full max-w-6xl mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24 items-start">
      <div class="flex flex-col justify-center space-y-6">
        <p
          class="text-sm font-bold uppercase tracking-[0.2em] text-lime-400 font-sans italic"
        >
          // Contacto
        </p>

        <h1
          class="text-6xl md:text-7xl lg:text-8xl font-black italic tracking-tighter text-white uppercase leading-[0.9]"
        >
          Hablemos<br /> de tu<br />
          <span class="text-lime-400">próximo<br /> movimiento.</span>
        </h1>

        <p
          class="text-lg text-neutral-300 max-w-md font-medium leading-relaxed"
        >
          Cuéntanos tu objetivo en la cancha o con tu marca. Nuestro equipo
          diseñará una estrategia ganadora a tu medida.
        </p>

        <div class="flex items-center gap-4 pt-4">
          <div class="flex -space-x-2">
            <div
              class="w-8 h-8 rounded-full bg-neutral-800 border-2 border-black"
            >
            </div>
            <div
              class="w-8 h-8 rounded-full bg-neutral-700 border-2 border-black"
            >
            </div>
            <div
              class="w-8 h-8 rounded-full bg-lime-500 border-2 border-black flex items-center justify-center"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 text-black"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"
                  clip-rule="evenodd"></path>
              </svg>
            </div>
          </div>
          <p class="text-sm font-bold text-white">
            Respuesta rápida: <span class="text-lime-400">Menos de 24h.</span>
          </p>
        </div>
      </div>

      <div class="w-full">
        <div
          class="bg-neutral-900/80 backdrop-blur-md border border-white/10 p-8 md:p-10 shadow-2xl relative overflow-hidden skew-y-1 rounded-none"
          style="clip-path: polygon(0 0, 100% 0, 100% 100%, 0 95%);"
        >
          <div class="absolute top-0 left-0 w-full h-1 bg-lime-400"></div>

          <form class="space-y-8 relative z-10 -skew-y-1">
            <div class="group">
              <label
                class="block text-xs font-black uppercase tracking-[0.1em] text-lime-400 mb-2 ml-1"
              >
                Nombre del Jugador
              </label>
              <input
                type="text"
                name="nombre"
                required
                placeholder="Tu nombre completo"
                class="w-full bg-transparent border-b-2 border-white/30 text-white text-lg font-bold px-1 py-3 placeholder:text-neutral-600 focus:outline-none focus:border-lime-400 transition-colors rounded-none"
              />
            </div>

            <div class="group">
              <label
                class="block text-xs font-black uppercase tracking-[0.1em] text-lime-400 mb-2 ml-1"
              >
                Correo Electrónico
              </label>
              <input
                type="email"
                name="email"
                required
                placeholder="tucorreo@ejemplo.com"
                class="w-full bg-transparent border-b-2 border-white/30 text-white text-lg font-bold px-1 py-3 placeholder:text-neutral-600 focus:outline-none focus:border-lime-400 transition-colors rounded-none"
              />
            </div>

            <div class="group">
              <label
                class="block text-xs font-black uppercase tracking-[0.1em] text-lime-400 mb-2 ml-1"
              >
                Tu Plan de Juego (Mensaje)
              </label>
              <textarea
                name="mensaje"
                rows="3"
                required
                placeholder="Cuéntanos tus objetivos, fechas clave..."
                class="w-full bg-transparent border-b-2 border-white/30 text-white text-lg font-bold px-1 py-3 placeholder:text-neutral-600 focus:outline-none focus:border-lime-400 transition-colors resize-none rounded-none leading-tight"
              ></textarea>
            </div>

            <div class="pt-6">
              <button
                type="submit"
                class="group relative w-full inline-flex items-center justify-center bg-lime-400 overflow-hidden px-8 py-4 transition-transform hover:scale-[1.02] active:scale-[0.98]"
              >
                <span
                  class="absolute inset-0 bg-white translate-y-full skew-y-12 transition-transform group-hover:translate-y-0"
                ></span>

                <span
                  class="relative text-base font-black uppercase italic tracking-widest text-black group-hover:text-black"
                >
                  Enviar Propuesta
                </span>
              </button>
              <p
                class="text-[10px] text-neutral-500 mt-4 text-center font-medium uppercase tracking-wider"
              >
                Al enviar aceptas la <a
                  href="#"
                  class="text-white underline decoration-lime-400 underline-offset-2"
                  >Política de privacidad</a
                >.
              </p>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import { supabase } from "@/lib/supabase";

  function showSuccessAlert() {
    const existing = document.querySelector(".cf-success-alert-overlay");
    if (existing) {
      existing.remove();
    }

    const overlay = document.createElement("div");
    overlay.className =
      "cf-success-alert-overlay fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm";

    const box = document.createElement("div");
    box.className =
      "bg-neutral-900 border border-lime-400/70 px-8 py-6 max-w-sm w-[90%] text-center shadow-2xl";

    const title = document.createElement("p");
    title.className =
      "text-sm font-black uppercase tracking-[0.2em] text-lime-400 mb-2";
    title.textContent = "Mensaje enviado";

    const text = document.createElement("p");
    text.className = "text-sm text-white/90 mb-4";
    text.textContent = "Nos pondremos en contacto contigo próximamente.";

    const button = document.createElement("button");
    button.className =
      "mt-2 inline-flex items-center justify-center px-6 py-2 bg-lime-400 text-black font-black uppercase tracking-widest text-xs";
    button.textContent = "Cerrar";
    button.addEventListener("click", function () {
      overlay.remove();
    });

    box.appendChild(title);
    box.appendChild(text);
    box.appendChild(button);
    overlay.appendChild(box);
    document.body.appendChild(overlay);
  }

  const form = document.querySelector("form") as HTMLFormElement;

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const nombre = formData.get("nombre") as string;
    const email = formData.get("email") as string;
    const mensaje = formData.get("mensaje") as string;

    if (!nombre || !email || !mensaje) {
      alert("Por favor completa todos los campos.");
      return;
    }

    const btn = form.querySelector("button") as HTMLButtonElement;
    const textoOriginal = btn.innerText;
    btn.innerText = "ENVIANDO...";
    btn.disabled = true;

    try {
      const { data, error } = await supabase
        .from("Contactos")
        .insert([{ nombre: nombre, email: email, mensaje: mensaje }]);

      if (error) throw error;

      showSuccessAlert();
      form.reset();
    } catch (error) {
      console.error("Error:", error);
      alert("Hubo un error al enviar. Intenta de nuevo.");
    } finally {
      btn.innerText = textoOriginal;
      btn.disabled = false;
    }
  });
</script>
